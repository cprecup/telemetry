

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>            Configuring Model-Driven Telemetry (MDT) with OpenConfig YANG      IOS XR Streaming Telemetry @xrdocs      </title>







<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="IOS XR Streaming Telemetry @xrdocs">
<meta property="og:title" content="Configuring Model-Driven Telemetry (MDT) with OpenConfig YANG">


  <link rel="canonical" href="https://xrdocs.github.io/telemetry/tutorials/2016-07-25-configuring-model-driven-telemetry-mdt-with-yang/">
  <meta property="og:url" content="https://xrdocs.github.io/telemetry/tutorials/2016-07-25-configuring-model-driven-telemetry-mdt-with-yang/">



  <meta property="og:description" content="Describes how to configure MDT with YANG models">



  <meta name="twitter:site" content="@xrdocs">
  <meta name="twitter:title" content="Configuring Model-Driven Telemetry (MDT) with OpenConfig YANG">
  <meta name="twitter:description" content="Describes how to configure MDT with YANG models">
  <meta name="twitter:url" content="https://xrdocs.github.io/tutorials/2016-07-25-configuring-model-driven-telemetry-mdt-with-yang/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="https://xrdocs.github.io/telemetry/images/telemetry-xrdocs.jpg">
    
  

  
    <meta name="twitter:creator" content="@scadora">
  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2016-07-25T17:42:00+00:00">
  
    <link rel="next" href="https://xrdocs.github.io/telemetry/tutorials/2016-08-08-configuring-model-driven-telemetry-with-ydk/" title="Configuring Model-Driven Telemetry (MDT) with YDK">
  
  
    <link rel="prev" href="https://xrdocs.github.io/telemetry/tutorials/2016-07-21-configuring-model-driven-telemetry-mdt/" title="Configuring Model-Driven Telemetry (MDT)">
  



  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "https://xrdocs.github.io/telemetry",
      "logo": "https://xrdocs.github.io/telemetry/images/telemetry-xrdocs.jpg"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "person",
      "name" : "Cisco Systems Inc",
      "url" : "https://xrdocs.github.io/telemetry",
      "sameAs" : ["https://twitter.com/CiscoDevNet"]
    }
  </script>






<!-- end SEO -->

<link href="https://xrdocs.github.io/telemetry/feed.xml" type="application/atom+xml" rel="alternate" title="IOS XR Streaming Telemetry @xrdocs Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-site-verification" content="jgRKKm6B9FwJJPXxpmc0-EP3D0Mh8JHXaJqoYIGj1ek" />

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<script>
if (!(window.location.host.startsWith("127.0.0.1") || window.location.host.startsWith("localhost")) && (window.location.host.substr(-10) == '.github.io') && (window.location.protocol != "https:"))
    window.location.protocol = "https";
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/telemetry/assets/css/main.css">
<meta http-equiv="cleartype" content="on">
<style>
.underline-on-hover:hover {
    text-decoration: underline;
}
.searchForm{
      border-radius:5px;
      -moz-border-radius:5px;
      -webkit-border-radius:5px;
      width: 900px;
   }
#search_results{
      display: table; margin:0 auto;
   }
</style>
</style>

    

<!-- start custom head snippets -->

<link href="https://xrdocs.github.io/telemetry/assets/css/lity.min.css" rel="stylesheet">
<link href="https://xrdocs.github.io/telemetry/assets/css/cisco-sans.min.css" rel="stylesheet">
<link href="https://xrdocs.github.io/telemetry/assets/css/material-scrolltop.css" rel="stylesheet">

<link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://xrdocs.github.io/telemetry/images/apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://xrdocs.github.io/telemetry/images/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://xrdocs.github.io/telemetry/images/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://xrdocs.github.io/telemetry/images/apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://xrdocs.github.io/telemetry/images/apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://xrdocs.github.io/telemetry/images/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://xrdocs.github.io/telemetry/images/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://xrdocs.github.io/telemetry/images/apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="https://xrdocs.github.io/telemetry/images/favicon-196x196.png" sizes="196x196" />
<link rel="icon" type="image/png" href="https://xrdocs.github.io/telemetry/images/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/png" href="https://xrdocs.github.io/telemetry/images/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="https://xrdocs.github.io/telemetry/images/favicon-16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="https://xrdocs.github.io/telemetry/images/favicon-128.png" sizes="128x128" />
<link rel="shortcut icon" href="https://xrdocs.github.io/telemetry/images/favicon_cisco.ico" />
<meta name="application-name" content="&nbsp;"/>
<meta name="msapplication-TileColor" content="#FFFFFF" />
<meta name="msapplication-TileImage" content="https://xrdocs.github.io/telemetry/images/mstile-144x144.png" />
<meta name="msapplication-square70x70logo" content="https://xrdocs.github.io/telemetry/images/mstile-70x70.png" />
<meta name="msapplication-square150x150logo" content="https://xrdocs.github.io/telemetry/images/mstile-150x150.png" />
<meta name="msapplication-wide310x150logo" content="https://xrdocs.github.io/telemetry/images/mstile-310x150.png" />
<meta name="msapplication-square310x310logo" content="https://xrdocs.github.io/telemetry/images/mstile-310x310.png" />


<!-- end custom head snippets -->

  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu" style="padding-left:2em;">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <img src="https://xrdocs.github.io/telemetry/images/xrdocs_logo.png" width="45px" height="45px" alt="xrdocs logo" style="float:left;">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="https://xrdocs.github.io">@xrdocs</a></li>
          <li class="masthead__menu-item"><a href="https://xrdocs.github.io/telemetry/">Telemetry</a></li>
          
            
            
                
                    <li class="masthead__menu-item"><a href="https://xrdocs.github.io/telemetry/blogs/">Blogs</a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item greedy-nav-active"><a href="https://xrdocs.github.io/telemetry/tutorials/">Tutorials</a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item"><a href="https://xrdocs.github.io/telemetry/search">Search <i class="fa fa-search" aria-hidden="true"></i></a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item"><a href="https://xrdocs.github.io/telemetry/tags/">Tags</a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item"><a href="https://xrdocs.github.io/telemetry/collection-archive/">Archive</a></li>
                
            


          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    




<div id="main" role="main">
  


  <div class="sidebar sticky">
  



<div itemscope itemtype="http://schema.org/Person">

  <div class="author__avatar">
    
    	<img src="https://xrdocs.github.io/telemetry/images/avatars/scadora16.jpeg" class="author__avatar" alt="Shelly Cadora">
    
  </div>

  <div class="author__content">
    <h3 class="author__name">Shelly Cadora</h3>
    <p class="author__bio">Principal Technical Marketing Engineer, Cisco</p>
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
      
      
        <li><a href="mailto:scadora@cisco.com"><i class="fa fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
      
      
      
        <li><a href="http://twitter.com/scadora"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
      
      
      
      
      
      
      
      
      
        <li><a href="http://github.com/scadora"><i class="fa fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Configuring Model-Driven Telemetry (MDT) with OpenConfig YANG">
    <meta itemprop="description" content="Describes how to configure MDT with YANG models">
    <meta itemprop="datePublished" content="July 25, 2016">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Configuring Model-Driven Telemetry (MDT) with OpenConfig YANG
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  6 minutes read
</p>
          
        </header>
      

    
      
        





<div class="breadcrumbs">
  <ol itemscope itemtype="http://schema.org/BreadcrumbList" style="margin:0;padding:0;">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem" style="margin:0;padding:0;">
          <a href="https://xrdocs.github.io/telemetry/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem" style="margin:0;padding:0;">
          <a href="https://xrdocs.github.io/telemetry/tutorials" itemprop="item"><span itemprop="name">Tutorials</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current" style="margin:0;padding:0;">Configuring Model-Driven Telemetry (MDT) with OpenConfig YANG</li>
      
    
  </ol>
</div>

      
    


      <section class="page__content" itemprop="text">

        <aside class="sidebar__right">
<nav class="toc">
    <header><h4 class="nav__title"><i class="fa fa-table"></i> Configuring MDT with OpenConfig YANG</h4></header>
<ul class="toc__menu" id="markdown-toc">
  <li><a href="#model-driven-configuration-for-model-driven-telemetry" id="markdown-toc-model-driven-configuration-for-model-driven-telemetry">Model-Driven Configuration for Model-Driven Telemetry</a></li>
  <li><a href="#the-models" id="markdown-toc-the-models">The Models</a></li>
  <li><a href="#get-config" id="markdown-toc-get-config">Get-Config</a></li>
  <li><a href="#edit-config" id="markdown-toc-edit-config">Edit-Config</a></li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ul>

  </nav>
</aside>

<h2 id="model-driven-configuration-for-model-driven-telemetry">Model-Driven Configuration for Model-Driven Telemetry</h2>

<p>In an <a href="https://xrdocs.github.io/telemetry/tutorials/2016-07-21-configuring-model-driven-telemetry-mdt/">earlier tutorial</a>, I wrote about how to configure MDT using CLI.  But if the router is using YANG models to structure the operational data it streams, shouldn’t we also be able to use models to configure the telemetry feature itself?  The answer is yes!  In this tutorial, we’ll look at the OpenConfig YANG model for telemetry and how to configure it.  I will use <a href="https://github.com/ncclient/ncclient">ncclient</a> as a simple Python NETCONF client, but you can use whatever client you want.</p>

<h2 id="the-models">The Models</h2>

<p>Let’s start with a quick look at the NETCONF capabilities list from IOS XR 6.1.1.  This bit of code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">ncclient</span> <span class="kn">import</span> <span class="n">manager</span>
<span class="kn">import</span> <span class="nn">re</span>
    
<span class="n">xr</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'10.30.111.9'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">830</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s">'cisco'</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">'cisco'</span><span class="p">,</span>
	<span class="n">allow_agent</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
	<span class="n">look_for_keys</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
	<span class="n">hostkey_verify</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
	<span class="n">unknown_host_cb</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">xr</span><span class="o">.</span><span class="n">server_capabilities</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'module=([^&amp;]*telemetry[^&amp;]*)&amp;'</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">model</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>     
</code></pre></div></div>

<p>…tells us that there are two models for telemetry configuration:</p>

<div class="notice--warning">

<p>Script Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openconfig-telemetry
Cisco-IOS-XR-telemetry-model-driven-cfg
</code></pre></div></div>

</div>

<p>The first model is the <a href="https://github.com/openconfig/public/blob/master/release/models/telemetry/openconfig-telemetry.yang">OpenConfig telemetry model</a> and the second is the XR native telemetry model.  If you look at them in detail, you will notice that the native model closely follows the OpenConfig model, although the native model will let you do things that are supported by IOS XR but not defined by this version of OpenConfig (like disabling TLS or enabling dial-out).  In this tutorial, I’ll focus on openconfig-telemetry, but you could do everything with Cisco-IOS-XR-telemetry-model-driven-cfg as well.</p>

<p>The NETCONF &lt;get-schema&gt; operation will give you the contents of the schema but the full YANG output can be really verbose and overwhelming, so I’ll pipe the output to the <a href="https://github.com/mbj4668/pyang">pyang</a> utility for a compact tree view with the following bit of code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span><span class="p">,</span> <span class="n">STDOUT</span>

<span class="n">oc</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">get_schema</span><span class="p">(</span><span class="s">'openconfig-telemetry'</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">([</span><span class="s">'pyang'</span><span class="p">,</span> <span class="s">'-f'</span><span class="p">,</span> <span class="s">'tree'</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span> 
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">oc</span><span class="o">.</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></div>

<p>And voila:</p>

<div class="notice--warning">

<p>Script Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module: openconfig-telemetry
   +--rw telemetry-system
      +--rw sensor-groups
      |  +--rw sensor-group* [sensor-group-id]
      |     +--rw sensor-group-id    -&gt; ../config/sensor-group-id
      |     +--rw config
      |     |  +--rw sensor-group-id?   string
      |     +--ro state
      |     |  +--ro sensor-group-id?   string
      |     +--rw sensor-paths
      |        +--rw sensor-path* [path]
      |           +--rw path      -&gt; ../config/path
      |           +--rw config
      |           |  +--rw path?             string
      |           |  +--rw exclude-filter?   string
      |           +--ro state
      |              +--ro path?             string
      |              +--ro exclude-filter?   string
      +--rw destination-groups
      |  +--rw destination-group* [group-id]
      |     +--rw group-id        -&gt; ../config/group-id
      |     +--rw config
      |     |  +--rw group-id?   string
      |     +--ro state
      |     |  +--ro group-id?   string
      |     +--rw destinations
      |        +--rw destination* [destination-address destination-port]
      |           +--rw destination-address    -&gt; ../config/destination-address
      |           +--rw destination-port       -&gt; ../config/destination-port
      |           +--rw config
      |           |  +--rw destination-address?    inet:ip-address
      |           |  +--rw destination-port?       uint16
      |           |  +--rw destination-protocol?   telemetry-stream-protocol
      |           +--ro state
      |              +--ro destination-address?    inet:ip-address
      |              +--ro destination-port?       uint16
      |              +--ro destination-protocol?   telemetry-stream-protocol
      +--rw subscriptions
         +--rw persistent
         |  +--rw subscription* [subscription-id]
         |     +--rw subscription-id       -&gt; ../config/subscription-id
         |     +--rw config
         |     |  +--rw subscription-id?          uint64
         |     |  +--rw local-source-address?     inet:ip-address
         |     |  +--rw originated-qos-marking?   inet:dscp
         |     +--ro state
         |     |  +--ro subscription-id?          uint64
         |     |  +--ro local-source-address?     inet:ip-address
         |     |  +--ro originated-qos-marking?   inet:dscp
         |     +--rw sensor-profiles
         |     |  +--rw sensor-profile* [sensor-group]
         |     |     +--rw sensor-group    -&gt; ../config/sensor-group
         |     |     +--rw config
         |     |     |  +--rw sensor-group?         -&gt; /telemetry-system/sensor-groups/sensor-group/config/sensor-group-id
         |     |     |  +--rw sample-interval?      uint64
         |     |     |  +--rw heartbeat-interval?   uint64
         |     |     |  +--rw suppress-redundant?   boolean
         |     |     +--ro state
         |     |        +--ro sensor-group?         -&gt; /telemetry-system/sensor-groups/sensor-group/config/sensor-group-id
         |     |        +--ro sample-interval?      uint64
         |     |        +--ro heartbeat-interval?   uint64
         |     |        +--ro suppress-redundant?   boolean
         |     +--rw destination-groups
         |        +--rw destination-group* [group-id]
         |           +--rw group-id    -&gt; ../config/group-id
         |           +--rw config
         |           |  +--rw group-id?   -&gt; ../../../../../../../destination-groups/destination-group/group-id
         |           +--rw state
         |              +--rw group-id?   -&gt; ../../../../../../../destination-groups/destination-group/group-id
         +--rw dynamic
            +--ro subscription* [subscription-id]
               +--ro subscription-id    -&gt; ../state/subscription-id
               +--ro state
               |  +--ro subscription-id?          uint64
               |  +--ro destination-address?      inet:ip-address
               |  +--ro destination-port?         uint16
               |  +--ro destination-protocol?     telemetry-stream-protocol
               |  +--ro sample-interval?          uint64
               |  +--ro heartbeat-interval?       uint64
               |  +--ro suppress-redundant?       boolean
               |  +--ro originated-qos-marking?   inet:dscp
               +--ro sensor-paths
                  +--ro sensor-path* [path]
                     +--ro path     -&gt; ../state/path
                     +--ro state
                        +--ro path?             string
                        +--ro exclude-filter?   string
</code></pre></div></div>

</div>

<p>You can spend a lot of time understanding the intricacies of YANG and all the details, but all we really need to know for now is that the model has three major sections:</p>

<ul>
  <li>The <strong>destination-group</strong> tells the router where to send telemetry data and how. Only needed for dial-out configuration.</li>
  <li>The <strong>sensor-group</strong> identifies a list of YANG models that the router should stream.</li>
  <li>The <strong>subscription</strong> ties together the destination-group and the sensor-group.</li>
</ul>

<p>Let’s see how this works in practice.</p>

<h2 id="get-config">Get-Config</h2>

<p>We can use the openconfig-telemetry model to filter for the telemetry config with the ncclient get_config operation:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">filter</span> <span class="o">=</span> <span class="s">'''&lt;telemetry-system xmlns="http://openconfig.net/yang/telemetry"&gt;'''</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s">'running'</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="p">(</span><span class="s">'subtree'</span><span class="p">,</span> <span class="nb">filter</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</code></pre></div></div>

<p>And here’s what we get:</p>

<div class="notice--warning">

<p>Script Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="nt">&lt;rpc-reply</span> <span class="na">message-id=</span><span class="s">"urn:uuid:939c718e-81ee-43ec-9733-565aa53fedb2"</span> <span class="na">xmlns:nc=</span><span class="s">"urn:ietf:params:xml:ns:netconf:base:1.0"</span> <span class="na">xmlns=</span><span class="s">"urn:ietf:params:xml:ns:netconf:base:1.0"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;data&gt;</span>
  <span class="nt">&lt;telemetry-system</span> <span class="na">xmlns=</span><span class="s">"http://openconfig.net/yang/telemetry"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;sensor-groups&gt;</span>
    <span class="nt">&lt;sensor-group&gt;</span>
     <span class="nt">&lt;sensor-group-id&gt;</span>SGroup3<span class="nt">&lt;/sensor-group-id&gt;</span>
     <span class="nt">&lt;config&gt;</span>
      <span class="nt">&lt;sensor-group-id&gt;</span>SGroup3<span class="nt">&lt;/sensor-group-id&gt;</span>
     <span class="nt">&lt;/config&gt;</span>
     <span class="nt">&lt;sensor-paths&gt;</span>
      <span class="nt">&lt;sensor-path&gt;</span>
       <span class="nt">&lt;path&gt;</span>openconfig-interfaces:interfaces/interface<span class="nt">&lt;/path&gt;</span>
       <span class="nt">&lt;config&gt;</span>
        <span class="nt">&lt;path&gt;</span>openconfig-interfaces:interfaces/interface<span class="nt">&lt;/path&gt;</span>
       <span class="nt">&lt;/config&gt;</span>
      <span class="nt">&lt;/sensor-path&gt;</span>
     <span class="nt">&lt;/sensor-paths&gt;</span>
    <span class="nt">&lt;/sensor-group&gt;</span>
   <span class="nt">&lt;/sensor-groups&gt;</span>
   <span class="nt">&lt;subscriptions&gt;</span>
    <span class="nt">&lt;persistent&gt;</span>
     <span class="nt">&lt;subscription&gt;</span>
      <span class="nt">&lt;subscription-id&gt;</span>Sub3<span class="nt">&lt;/subscription-id&gt;</span>
      <span class="nt">&lt;config&gt;</span>
       <span class="nt">&lt;subscription-id&gt;</span>Sub3<span class="nt">&lt;/subscription-id&gt;</span>
      <span class="nt">&lt;/config&gt;</span>
      <span class="nt">&lt;sensor-profiles&gt;</span>
       <span class="nt">&lt;sensor-profile&gt;</span>
        <span class="nt">&lt;sensor-group&gt;</span>SGroup3<span class="nt">&lt;/sensor-group&gt;</span>
        <span class="nt">&lt;config&gt;</span>
         <span class="nt">&lt;sensor-group&gt;</span>SGroup3<span class="nt">&lt;/sensor-group&gt;</span>
         <span class="nt">&lt;sample-interval&gt;</span>30000<span class="nt">&lt;/sample-interval&gt;</span>
        <span class="nt">&lt;/config&gt;</span>
       <span class="nt">&lt;/sensor-profile&gt;</span>
      <span class="nt">&lt;/sensor-profiles&gt;</span>
     <span class="nt">&lt;/subscription&gt;</span>
    <span class="nt">&lt;/persistent&gt;</span>
   <span class="nt">&lt;/subscriptions&gt;</span>
  <span class="nt">&lt;/telemetry-system&gt;</span>
 <span class="nt">&lt;/data&gt;</span>
<span class="nt">&lt;/rpc-reply&gt;</span>


</code></pre></div></div>

</div>

<p>So what does all that mean to the router?  It breaks down into three parts which you’ll recall from the YANG model above:</p>

<ul>
  <li>The <strong>destination-group</strong> tells the router where to send telemetry data and how.  The absence of a destination-group in the output above alerts us to the fact that this is a dial-in configuration (the collector will initiate the session to the router).</li>
  <li>The <strong>sensor-group</strong> identifies a list of YANG models that the router should stream.  In this case, the router has a sensor-group called “SGroup3” that will send interface statistics data from the OpenConfig Interfaces YANG model.</li>
  <li>The <strong>subscription</strong> ties together the destination-group and the sensor-group.  This router has a subscription name “Sub3” that will send the list of models in SGroup3 at an interval of 30 second (30000 milleseconds).</li>
</ul>

<p>If you read the <a href="https://xrdocs.github.io/telemetry/tutorials/2016-07-21-configuring-model-driven-telemetry-mdt/">earlier tutorial</a> on configuring MDT with CLI, you might recognize this as the same as the gRPC dial-in configuration described there.  If you missed that thrilling installment, the XML above is the YANG equivalent of this CLI:</p>

<div class="notice--info">

<p>CLI Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>telemetry model-driven
 sensor-group SGroup3
  sensor-path openconfig-interfaces:interfaces/interface
 !
 subscription Sub3
  sensor-group-id SGroup3 sample-interval 30000
 !  
</code></pre></div></div>


</div>

<h2 id="edit-config">Edit-Config</h2>

<p>So let’s say we want to add a second model to SGroup3 (Cisco-IOS-XR-ipv4-arp-oper).  We can do that with the following NETCONF operations:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">edit_data</span> <span class="o">=</span> <span class="s">'''
&lt;config&gt;
&lt;telemetry-system xmlns="http://openconfig.net/yang/telemetry"&gt;
   &lt;sensor-groups&gt;
    &lt;sensor-group&gt;
     &lt;sensor-group-id&gt;SGroup3&lt;/sensor-group-id&gt;
     &lt;sensor-paths&gt;
      &lt;sensor-path&gt;
       &lt;config&gt;
        &lt;path&gt;Cisco-IOS-XR-ipv4-arp-oper:arp/nodes/node/entries/entry&lt;/path&gt;
       &lt;/config&gt;
      &lt;/sensor-path&gt;
     &lt;/sensor-paths&gt;
    &lt;/sensor-group&gt;
   &lt;/sensor-groups&gt;
&lt;/config&gt;
'''</span>

<span class="n">xr</span><span class="o">.</span><span class="n">edit_config</span><span class="p">(</span><span class="n">edit_data</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s">'candidate'</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">'xml'</span><span class="p">)</span>
<span class="n">xr</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div></div>

<p>If we do a get-config operation again:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">c</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s">'running'</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="p">(</span><span class="s">'subtree'</span><span class="p">,</span> <span class="nb">filter</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</code></pre></div></div>

<p>… we’ll see that SGroup3 has the new addition.</p>

<div class="notice--warning">

<p>Script Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="nt">&lt;rpc-reply</span> <span class="na">message-id=</span><span class="s">"urn:uuid:abd0a7ee-5f06-4754-b2a3-dae6e3d797aa"</span> <span class="na">xmlns:nc=</span><span class="s">"urn:ietf:params:xml:ns:netconf:base:1.0"</span> <span class="na">xmlns=</span><span class="s">"urn:ietf:params:xml:ns:netconf:base:1.0"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;data&gt;</span>
  <span class="nt">&lt;telemetry-system</span> <span class="na">xmlns=</span><span class="s">"http://openconfig.net/yang/telemetry"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;sensor-groups&gt;</span>
    <span class="nt">&lt;sensor-group&gt;</span>
     <span class="nt">&lt;sensor-group-id&gt;</span>SGroup3<span class="nt">&lt;/sensor-group-id&gt;</span>
     <span class="nt">&lt;config&gt;</span>
      <span class="nt">&lt;sensor-group-id&gt;</span>SGroup3<span class="nt">&lt;/sensor-group-id&gt;</span>
     <span class="nt">&lt;/config&gt;</span>
     <span class="nt">&lt;sensor-paths&gt;</span>
      <span class="nt">&lt;sensor-path&gt;</span>
       <span class="nt">&lt;path&gt;</span>openconfig-interfaces:interfaces/interface<span class="nt">&lt;/path&gt;</span>
       <span class="nt">&lt;config&gt;</span>
        <span class="nt">&lt;path&gt;</span>openconfig-interfaces:interfaces/interface<span class="nt">&lt;/path&gt;</span>
       <span class="nt">&lt;/config&gt;</span>
      <span class="nt">&lt;/sensor-path&gt;</span>
      <span class="nt">&lt;sensor-path&gt;</span>
       <span class="nt">&lt;path&gt;</span>Cisco-IOS-XR-ipv4-arp-oper:arp/nodes/node/entries/entry<span class="nt">&lt;/path&gt;</span>
       <span class="nt">&lt;config&gt;</span>
        <span class="nt">&lt;path&gt;</span>Cisco-IOS-XR-ipv4-arp-oper:arp/nodes/node/entries/entry<span class="nt">&lt;/path&gt;</span>
       <span class="nt">&lt;/config&gt;</span>
      <span class="nt">&lt;/sensor-path&gt;</span>
     <span class="nt">&lt;/sensor-paths&gt;</span>
    <span class="nt">&lt;/sensor-group&gt;</span>
   <span class="nt">&lt;/sensor-groups&gt;</span>
   <span class="nt">&lt;subscriptions&gt;</span>
    <span class="nt">&lt;persistent&gt;</span>
     <span class="nt">&lt;subscription&gt;</span>
      <span class="nt">&lt;subscription-id&gt;</span>Sub3<span class="nt">&lt;/subscription-id&gt;</span>
      <span class="nt">&lt;config&gt;</span>
       <span class="nt">&lt;subscription-id&gt;</span>Sub3<span class="nt">&lt;/subscription-id&gt;</span>
      <span class="nt">&lt;/config&gt;</span>
      <span class="nt">&lt;sensor-profiles&gt;</span>
       <span class="nt">&lt;sensor-profile&gt;</span>
        <span class="nt">&lt;sensor-group&gt;</span>SGroup3<span class="nt">&lt;/sensor-group&gt;</span>
        <span class="nt">&lt;config&gt;</span>
         <span class="nt">&lt;sensor-group&gt;</span>SGroup3<span class="nt">&lt;/sensor-group&gt;</span>
         <span class="nt">&lt;sample-interval&gt;</span>30000<span class="nt">&lt;/sample-interval&gt;</span>
        <span class="nt">&lt;/config&gt;</span>
       <span class="nt">&lt;/sensor-profile&gt;</span>
      <span class="nt">&lt;/sensor-profiles&gt;</span>
     <span class="nt">&lt;/subscription&gt;</span>
    <span class="nt">&lt;/persistent&gt;</span>
   <span class="nt">&lt;/subscriptions&gt;</span>
  <span class="nt">&lt;/telemetry-system&gt;</span>
 <span class="nt">&lt;/data&gt;</span>
<span class="nt">&lt;/rpc-reply&gt;</span>

</code></pre></div></div>

</div>

<p>And if you need some CLI to reassure yourself that it worked, here it is:</p>

<div class="notice--info">

<p>CLI Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RP/0/RP0/CPU0:SunC#show run telemetry model-driven
Mon Aug  8 20:09:57.149 UTC
telemetry model-driven
 sensor-group SGroup3
  sensor-path openconfig-interfaces:interfaces/interface
  sensor-path Cisco-IOS-XR-ipv4-arp-oper:arp/nodes/node/entries/entry
 !
 subscription Sub3
  sensor-group-id SGroup3 sample-interval 30000
 !
!
</code></pre></div></div>

</div>

<h2 id="conclusion">Conclusion</h2>
<p>Armed with the examples in this blog and a understanding of the telemetry YANG model, you should now be able to use YANG configuration models to configure the router to stream YANG models with the operational data you want.  How’s that for model-driven programmability?</p>


        
      </section>

      <footer class="page__meta">
        
        




  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="https://xrdocs.github.io/telemetry/tags/#iosxr" class="page__taxonomy-item" rel="tag">iosxr</a><span class="sep">, </span>
    
      
      
      <a href="https://xrdocs.github.io/telemetry/tags/#mdt" class="page__taxonomy-item" rel="tag">MDT</a><span class="sep">, </span>
    
      
      
      <a href="https://xrdocs.github.io/telemetry/tags/#telemetry" class="page__taxonomy-item" rel="tag">telemetry</a><span class="sep">, </span>
    
      
      
      <a href="https://xrdocs.github.io/telemetry/tags/#yang" class="page__taxonomy-item" rel="tag">YANG</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2016-07-25T17:42:00+00:00">July 25, 2016</time></p>
        
      </footer>

      

<section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=https://xrdocs.github.io/telemetry/tutorials/2016-07-25-configuring-model-driven-telemetry-mdt-with-yang/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https://xrdocs.github.io/telemetry/tutorials/2016-07-25-configuring-model-driven-telemetry-mdt-with-yang/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=https://xrdocs.github.io/telemetry/tutorials/2016-07-25-configuring-model-driven-telemetry-mdt-with-yang/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://xrdocs.github.io/telemetry/tutorials/2016-07-25-configuring-model-driven-telemetry-mdt-with-yang/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>

    <br>
    <br>
    <br>
</section>


    </div>

    
      

<div class="page__comments">
  <h4 class="page__comments-title">Leave a Comment</h4>
  
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/xrdocs"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/xrdocs"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="https://xrdocs.github.io/telemetry/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 Cisco Systems Inc. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="https://xrdocs.github.io/telemetry/assets/js/main.min.js"></script>
<script src="https://xrdocs.github.io/telemetry/assets/js/scrollmenu.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-78256516-1', 'auto');
  ga('send', 'pageview');
</script>






  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'xrdocs';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






<!-- material-scrolltop button -->
<button class="material-scrolltop" type="button"></button>

<!-- material-scrolltop plugin -->
<script src="https://xrdocs.github.io/telemetry/assets/js/material-scrolltop.js"></script>

<!-- Initialize material-scrolltop with (minimal) -->
<script>
    $('body').materialScrollTop();
</script>


  </body>
</html>

