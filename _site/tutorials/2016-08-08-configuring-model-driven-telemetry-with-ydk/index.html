

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>            Configuring Model-Driven Telemetry (MDT) with YDK      IOS XR Streaming Telemetry @xrdocs      </title>







<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="IOS XR Streaming Telemetry @xrdocs">
<meta property="og:title" content="Configuring Model-Driven Telemetry (MDT) with YDK">


  <link rel="canonical" href="https://xrdocs.github.io/telemetry/tutorials/2016-08-08-configuring-model-driven-telemetry-with-ydk/">
  <meta property="og:url" content="https://xrdocs.github.io/telemetry/tutorials/2016-08-08-configuring-model-driven-telemetry-with-ydk/">



  <meta property="og:description" content="     Configuring MDT with YDK  ">



  <meta name="twitter:site" content="@xrdocs">
  <meta name="twitter:title" content="Configuring Model-Driven Telemetry (MDT) with YDK">
  <meta name="twitter:description" content="     Configuring MDT with YDK  ">
  <meta name="twitter:url" content="https://xrdocs.github.io/tutorials/2016-08-08-configuring-model-driven-telemetry-with-ydk/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="https://xrdocs.github.io/telemetry/images/telemetry-xrdocs.jpg">
    
  

  
    <meta name="twitter:creator" content="@scadora">
  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2016-08-08T23:52:00+00:00">
  
    <link rel="next" href="https://xrdocs.github.io/telemetry/tutorials/2016-08-15-configuring-mdt-for-tcp-dial-out-using-native-yang/" title="Configuring Model-Driven-Telemetry (MDT) for Dial-out Using Native YANG">
  
  
    <link rel="prev" href="https://xrdocs.github.io/telemetry/tutorials/2016-07-25-configuring-model-driven-telemetry-mdt-with-yang/" title="Configuring Model-Driven Telemetry (MDT) with OpenConfig YANG">
  



  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "https://xrdocs.github.io/telemetry",
      "logo": "https://xrdocs.github.io/telemetry/images/telemetry-xrdocs.jpg"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "person",
      "name" : "Cisco Systems Inc",
      "url" : "https://xrdocs.github.io/telemetry",
      "sameAs" : ["https://twitter.com/CiscoDevNet"]
    }
  </script>






<!-- end SEO -->

<link href="https://xrdocs.github.io/telemetry/feed.xml" type="application/atom+xml" rel="alternate" title="IOS XR Streaming Telemetry @xrdocs Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-site-verification" content="jgRKKm6B9FwJJPXxpmc0-EP3D0Mh8JHXaJqoYIGj1ek" />

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<script>
if (!(window.location.host.startsWith("127.0.0.1") || window.location.host.startsWith("localhost")) && (window.location.host.substr(-10) == '.github.io') && (window.location.protocol != "https:"))
    window.location.protocol = "https";
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/telemetry/assets/css/main.css">
<meta http-equiv="cleartype" content="on">
<style>
.underline-on-hover:hover {
    text-decoration: underline;
}
.searchForm{
      border-radius:5px;
      -moz-border-radius:5px;
      -webkit-border-radius:5px;
      width: 900px;
   }
#search_results{
      display: table; margin:0 auto;
   }
</style>
</style>

    

<!-- start custom head snippets -->

<link href="https://xrdocs.github.io/telemetry/assets/css/lity.min.css" rel="stylesheet">
<link href="https://xrdocs.github.io/telemetry/assets/css/cisco-sans.min.css" rel="stylesheet">
<link href="https://xrdocs.github.io/telemetry/assets/css/material-scrolltop.css" rel="stylesheet">

<link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://xrdocs.github.io/telemetry/images/apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://xrdocs.github.io/telemetry/images/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://xrdocs.github.io/telemetry/images/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://xrdocs.github.io/telemetry/images/apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://xrdocs.github.io/telemetry/images/apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://xrdocs.github.io/telemetry/images/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://xrdocs.github.io/telemetry/images/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://xrdocs.github.io/telemetry/images/apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="https://xrdocs.github.io/telemetry/images/favicon-196x196.png" sizes="196x196" />
<link rel="icon" type="image/png" href="https://xrdocs.github.io/telemetry/images/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/png" href="https://xrdocs.github.io/telemetry/images/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="https://xrdocs.github.io/telemetry/images/favicon-16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="https://xrdocs.github.io/telemetry/images/favicon-128.png" sizes="128x128" />
<link rel="shortcut icon" href="https://xrdocs.github.io/telemetry/images/favicon_cisco.ico" />
<meta name="application-name" content="&nbsp;"/>
<meta name="msapplication-TileColor" content="#FFFFFF" />
<meta name="msapplication-TileImage" content="https://xrdocs.github.io/telemetry/images/mstile-144x144.png" />
<meta name="msapplication-square70x70logo" content="https://xrdocs.github.io/telemetry/images/mstile-70x70.png" />
<meta name="msapplication-square150x150logo" content="https://xrdocs.github.io/telemetry/images/mstile-150x150.png" />
<meta name="msapplication-wide310x150logo" content="https://xrdocs.github.io/telemetry/images/mstile-310x150.png" />
<meta name="msapplication-square310x310logo" content="https://xrdocs.github.io/telemetry/images/mstile-310x310.png" />


<!-- end custom head snippets -->

  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu" style="padding-left:2em;">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <img src="https://xrdocs.github.io/telemetry/images/xrdocs_logo.png" width="45px" height="45px" alt="xrdocs logo" style="float:left;">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="https://xrdocs.github.io">@xrdocs</a></li>
          <li class="masthead__menu-item"><a href="https://xrdocs.github.io/telemetry/">Telemetry</a></li>
          
            
            
                
                    <li class="masthead__menu-item"><a href="https://xrdocs.github.io/telemetry/blogs/">Blogs</a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item greedy-nav-active"><a href="https://xrdocs.github.io/telemetry/tutorials/">Tutorials</a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item"><a href="https://xrdocs.github.io/telemetry/search">Search <i class="fa fa-search" aria-hidden="true"></i></a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item"><a href="https://xrdocs.github.io/telemetry/tags/">Tags</a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item"><a href="https://xrdocs.github.io/telemetry/collection-archive/">Archive</a></li>
                
            


          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    




<div id="main" role="main">
  


  <div class="sidebar sticky">
  



<div itemscope itemtype="http://schema.org/Person">

  <div class="author__avatar">
    
    	<img src="https://xrdocs.github.io/telemetry/images/avatars/scadora16.jpeg" class="author__avatar" alt="Shelly Cadora">
    
  </div>

  <div class="author__content">
    <h3 class="author__name">Shelly Cadora</h3>
    <p class="author__bio">Principal Technical Marketing Engineer, Cisco</p>
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
      
      
        <li><a href="mailto:scadora@cisco.com"><i class="fa fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
      
      
      
        <li><a href="http://twitter.com/scadora"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
      
      
      
      
      
      
      
      
      
        <li><a href="http://github.com/scadora"><i class="fa fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Configuring Model-Driven Telemetry (MDT) with YDK">
    <meta itemprop="description" content="     Configuring MDT with YDK  ">
    <meta itemprop="datePublished" content="August 08, 2016">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Configuring Model-Driven Telemetry (MDT) with YDK
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  4 minutes read
</p>
          
        </header>
      

    
      
        





<div class="breadcrumbs">
  <ol itemscope itemtype="http://schema.org/BreadcrumbList" style="margin:0;padding:0;">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem" style="margin:0;padding:0;">
          <a href="https://xrdocs.github.io/telemetry/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem" style="margin:0;padding:0;">
          <a href="https://xrdocs.github.io/telemetry/tutorials" itemprop="item"><span itemprop="name">Tutorials</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current" style="margin:0;padding:0;">Configuring Model-Driven Telemetry (MDT) with YDK</li>
      
    
  </ol>
</div>

      
    


      <section class="page__content" itemprop="text">

        <aside class="sidebar__right">
<nav class="toc">
    <header><h4 class="nav__title"><i class="fa fa-table"></i> Configuring MDT with YDK</h4></header>
<ul class="toc__menu" id="markdown-toc">
  <li><a href="#ydk-automating-yang-without-xml" id="markdown-toc-ydk-automating-yang-without-xml">YDK: Automating YANG without XML</a></li>
  <li><a href="#connect-to-the-router" id="markdown-toc-connect-to-the-router">Connect to the router</a></li>
  <li><a href="#define-the-sensor-group" id="markdown-toc-define-the-sensor-group">Define the sensor group</a></li>
  <li><a href="#apply-the-sensorgroup-object-to-the-router" id="markdown-toc-apply-the-sensorgroup-object-to-the-router">Apply the SensorGroup object to the router</a></li>
  <li><a href="#instantiate-a-subscription-object-and-apply-it" id="markdown-toc-instantiate-a-subscription-object-and-apply-it">Instantiate a Subscription object and apply it</a></li>
  <li><a href="#what-did-all-that-code-do" id="markdown-toc-what-did-all-that-code-do">What did all that code do?</a></li>
  <li><a href="#clean-up-clean-up-everybody-clean-up" id="markdown-toc-clean-up-clean-up-everybody-clean-up">Clean up, clean up, everybody clean up!</a></li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ul>

  </nav>
</aside>

<h2 id="ydk-automating-yang-without-xml">YDK: Automating YANG without XML</h2>

<p>In an <a href="https://xrdocs.github.io/telemetry/tutorials/2016-07-25-configuring-model-driven-telemetry-mdt-with-yang/">earlier tutorial</a>, I wrote about how to configure MDT using the OpenConfig Telemetry YANG model with <a href="https://github.com/ncclient/ncclient">ncclient</a> and a lot of XML.  An even simpler way to do this is to use <a href="https://developer.cisco.com/site/ydk/">YDK</a>, a developer toolkit that automatically generates APIs directly from YANG models.  The Python classes that are generated by YDK mirror the YANG model hierarchy. So if you know some Python and you understand the YANG model, you can start writing code, no knowledge of NETCONF or XML required.</p>

<p>In this blog, I’ll explain how to configure telemetry for gRPC dialin using YDK and the OpenConfig Telemetry YANG model.</p>

<h2 id="connect-to-the-router">Connect to the router</h2>

<p>YDK leverages ncclient to handle the NETCONF connection, so this bit of code might look similar to what you’ve done before, using the YDK provider library instead of ncclient:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">ydk.providers</span> <span class="kn">import</span> <span class="n">NetconfServiceProvider</span>
<span class="kn">from</span> <span class="nn">ydk.services</span> <span class="kn">import</span> <span class="n">CRUDService</span>

<span class="n">HOST</span> <span class="o">=</span> <span class="s">'10.30.111.9'</span>
<span class="n">PORT</span> <span class="o">=</span> <span class="mi">830</span>
<span class="n">USER</span> <span class="o">=</span> <span class="s">'cisco'</span>
<span class="n">PASS</span> <span class="o">=</span> <span class="s">'cisco'</span>

<span class="n">xr</span> <span class="o">=</span> <span class="n">NetconfServiceProvider</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">HOST</span><span class="p">,</span>
	<span class="n">port</span><span class="o">=</span><span class="n">PORT</span><span class="p">,</span>
	<span class="n">username</span><span class="o">=</span><span class="n">USER</span><span class="p">,</span>
	<span class="n">password</span><span class="o">=</span><span class="n">PASS</span><span class="p">,</span>
	<span class="n">protocol</span> <span class="o">=</span> <span class="s">'ssh'</span><span class="p">)</span>
</code></pre></div></div>

<p>With that, we are now connected to the router:</p>

<div class="notice--info">

<p>CLI Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RP/0/RP0/CPU0:SunC#show netconf-yang clients
Mon Aug  8 23:01:48.210 UTC
Netconf clients
client session ID|     NC version|    client connect time|        last OP time|        last OP type|    &lt;lock&gt;|
       1386485520|            1.1|         0d  0h  0m  5s|                    |                    |        No|
RP/0/RP0/CPU0:SunC#
</code></pre></div></div>


</div>

<h2 id="define-the-sensor-group">Define the sensor group</h2>

<p>Now that our script is connected to the router, we’ll start by defining the sensor-group.  Here’s the first bit of YDK for that:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">ydk.models.openconfig.openconfig_telemetry</span> <span class="k">as</span> <span class="n">oc_telemetry</span>

<span class="n">sgroup</span> <span class="o">=</span> <span class="n">oc_telemetry</span><span class="o">.</span><span class="n">TelemetrySystem</span><span class="o">.</span><span class="n">SensorGroups</span><span class="o">.</span><span class="n">SensorGroup</span><span class="p">()</span>
<span class="n">sgroup</span><span class="o">.</span><span class="n">sensor_group_id</span><span class="o">=</span><span class="s">"SGroup4"</span>
<span class="n">sgroup</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sensor_group_id</span><span class="o">=</span><span class="s">"SGroup4"</span>
</code></pre></div></div>

<p>So how did I come up with that?  Look back at the first part of the OC Telemetry YANG model:</p>

<div class="notice--warning">

<p>PYANG Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module: openconfig-telemetry
   +--rw telemetry-system
      +--rw sensor-groups
      |  +--rw sensor-group* [sensor-group-id]
      |     +--rw sensor-group-id    -&gt; ../config/sensor-group-id
      |     +--rw config
      |     |  +--rw sensor-group-id?   string

</code></pre></div></div>

</div>

<p>Start from the top and walk down from telemetry-system to sensor-groups to sensor-group.  Replace the dashes and lowercase syntax with CamelCase syntax and you get the class that instantiates that first object: TelemetrySystem.SensorGroups.SensorGroup().  Down to the next level, we have the leaf “sensor-group-id.”  YDK converts this to an object attribute by replacing the hyphens with underscores.  The sensor-group-id list key is actually a leaf-ref to config/sensor-group-id, both of which are required (hence the two lines that seem redundant but are actually required for syntactic validation because of the structure of the YANG model).</p>

<p>Going down a little farther in the YANG model with some help from some pyang options, we see that the sensor-group contains a list of sensor-paths.</p>

<div class="notice--warning">

<p>PYANG Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pyang -f tree openconfig-telemetry.yang --tree-path=telemetry-system/sensor-groups/sensor-group/sensor-paths/sensor-path/config
module: openconfig-telemetry
   +--rw telemetry-system
      +--rw sensor-groups
         +--rw sensor-group* [sensor-group-id]
            +--rw sensor-paths
               +--rw sensor-path* [path]
                  +--rw config
                     +--rw path?             string
$
</code></pre></div></div>

</div>

<p>This is how that maps to YDK code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sgroup</span><span class="o">.</span><span class="n">sensor_paths</span> <span class="o">=</span> <span class="n">sgroup</span><span class="o">.</span><span class="n">SensorPaths</span><span class="p">()</span>
<span class="n">new_sensorpath</span> <span class="o">=</span> <span class="n">sgroup</span><span class="o">.</span><span class="n">SensorPaths</span><span class="o">.</span><span class="n">SensorPath</span><span class="p">()</span>

<span class="n">new_sensorpath</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s">'Cisco-IOS-XR-infra-statsd-oper:infra-statistics</span><span class="si">%2</span><span class="s">finterfaces</span><span class="si">%2</span><span class="s">finterface</span><span class="si">%2</span><span class="s">flatest</span><span class="si">%2</span><span class="s">fgeneric-counters'</span>
<span class="n">new_sensorpath</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s">'Cisco-IOS-XR-infra-statsd-oper:infra-statistics</span><span class="si">%2</span><span class="s">finterfaces</span><span class="si">%2</span><span class="s">finterface</span><span class="si">%2</span><span class="s">flatest</span><span class="si">%2</span><span class="s">fgeneric-counters'</span>

<span class="n">sgroup</span><span class="o">.</span><span class="n">sensor_paths</span><span class="o">.</span><span class="n">sensor_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_sensorpath</span><span class="p">)</span>
</code></pre></div></div>

<p>So again, following the YANG model, we define the top-level SensorPaths object, then a SensorPath with an object attribute “path” that actually specifies the YANG model that we want to stream (in this case, our old friend, interface statistics).</p>

<p>Note that the “%2f” in the path attributes represent URL encodings of the forward slash character (“/”).  The code would look a little better if you used a utility such as urllib to do the string substitution for you, so you can use the more natural looking path with “/” characters like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib</span>

<span class="n">sgroup</span><span class="o">.</span><span class="n">sensor_paths</span> <span class="o">=</span> <span class="n">sgroup</span><span class="o">.</span><span class="n">SensorPaths</span><span class="p">()</span>
<span class="n">new_sensorpath</span> <span class="o">=</span> <span class="n">sgroup</span><span class="o">.</span><span class="n">SensorPaths</span><span class="o">.</span><span class="n">SensorPath</span><span class="p">()</span>

<span class="n">interface_stats_path</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="s">'Cisco-IOS-XR-infra-statsd-oper:infra-statistics/interfaces/interface/latest/generic-counters'</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s">':'</span><span class="p">)</span>
<span class="n">new_sensorpath</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">interface_stats_path</span>
<span class="n">new_sensorpath</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">interface_stats_path</span>

<span class="n">sgroup</span><span class="o">.</span><span class="n">sensor_paths</span><span class="o">.</span><span class="n">sensor_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_sensorpath</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="apply-the-sensorgroup-object-to-the-router">Apply the SensorGroup object to the router</h2>

<p>Once you’ve populated the object, it’s trivial to apply it to the router using the create method on the CRUDService object from YDK:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">ydk.services</span> <span class="kn">import</span> <span class="n">CRUDService</span>

<span class="n">rpc_service</span> <span class="o">=</span> <span class="n">CRUDService</span><span class="p">()</span>
<span class="n">rpc_service</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">xr</span><span class="p">,</span> <span class="n">sgroup</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="instantiate-a-subscription-object-and-apply-it">Instantiate a Subscription object and apply it</h2>

<p>The Subscription is the final piece of the config.  Again, refer to the YANG model to understand the Python class that you should use.  I’ll use pyang with the tree-path option to make it clearer:</p>

<div class="notice--warning">

<p>PYANG Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$pyang -f tree --tree-path telemetry-system/subscriptions/persistent/subscription/sensor-profiles/sensor-profile openconfig-telemetry.yang

module: openconfig-telemetry
   +--rw telemetry-system
      +--rw subscriptions
         +--rw persistent
            +--rw subscription* [subscription-id]
               +--rw sensor-profiles
                  +--rw sensor-profile* [sensor-group]
                     +--rw sensor-group    -&gt; ../config/sensor-group
                     +--rw config
                     |  +--rw sensor-group?         -&gt; /telemetry-system/sensor-groups/sensor-group/config/sensor-group-id
                     |  +--rw sample-interval?      uint64
                     |  +--rw heartbeat-interval?   uint64
                     |  +--rw suppress-redundant?   boolean
                     +--ro state
                        +--ro sensor-group?         -&gt; /telemetry-system/sensor-groups/sensor-group/config/sensor-group-id
                        +--ro sample-interval?      uint64
                        +--ro heartbeat-interval?   uint64
                        +--ro suppress-redundant?   boolean

</code></pre></div></div>

</div>

<p>This is how that ends up in YDK code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sub</span> <span class="o">=</span> <span class="n">oc_telemetry</span><span class="o">.</span><span class="n">TelemetrySystem</span><span class="o">.</span><span class="n">Subscriptions</span><span class="o">.</span><span class="n">Persistent</span><span class="o">.</span><span class="n">Subscription</span><span class="p">()</span>
<span class="n">sub</span><span class="o">.</span><span class="n">subscription_id</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">sub</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">subscription_id</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">sub</span><span class="o">.</span><span class="n">sensor_profiles</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">SensorProfiles</span><span class="p">()</span>

<span class="n">new_sgroup</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">SensorProfiles</span><span class="o">.</span><span class="n">SensorProfile</span><span class="p">()</span>
<span class="n">new_sgroup</span><span class="o">.</span><span class="n">sensor_group</span> <span class="o">=</span> <span class="s">'SGroup4'</span>
<span class="n">new_sgroup</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sensor_group</span> <span class="o">=</span> <span class="s">'SGroup4'</span>
<span class="n">new_sgroup</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sample_interval</span> <span class="o">=</span> <span class="mi">30000</span>

<span class="n">sub</span><span class="o">.</span><span class="n">sensor_profiles</span><span class="o">.</span><span class="n">sensor_profile</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_sgroup</span><span class="p">)</span>

<span class="n">rpc_service</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">xr</span><span class="p">,</span> <span class="n">sub</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="what-did-all-that-code-do">What did all that code do?</h2>

<p>So this is how all that shows up in CLI:</p>

<div class="notice--info">

<p>CLI Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RP/0/RP0/CPU0:SunC#show run telemetry model-driven
Tue Aug  9 17:52:38.462 UTC
telemetry model-driven
 sensor-group SGroup4
  sensor-path Cisco-IOS-XR-infra-statsd-oper:infra-statistics/interfaces/interface/latest/generic-counters
 !
 subscription 4
  sensor-group-id SGroup4 sample-interval 30000
 !
!

RP/0/RP0/CPU0:SunC#
</code></pre></div></div>


</div>

<p>And that is all you need for Model-Driven Telemetry using gRPC dialin.</p>

<h2 id="clean-up-clean-up-everybody-clean-up">Clean up, clean up, everybody clean up!</h2>
<p>Need to delete the telemetry config completely?  Here’s how:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rpc_service</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">xr</span><span class="p">,</span> <span class="n">oc_telemetry</span><span class="o">.</span><span class="n">TelemetrySystem</span><span class="p">())</span>
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>
<p>In this tutorial, we looked at a couple dozen lines of YDK code that added and then removed five lines of CLI.  So you might be thinking “and that helps me be more efficient…how?”  But the power of automation in general and YDK in particular can’t be fully revealed in a single, simple example like this.  The real power of YDK is that it allows you to do this for any YANG model on the box, automatically generating Python classes that inherit the syntactic checks and requirements of the underlying model, while also handling all the details of the underlying encoding and transport (no understanding of XML or NETCONF chunk framing required!).  Give a try and see what you think!</p>


        
      </section>

      <footer class="page__meta">
        
        




  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="https://xrdocs.github.io/telemetry/tags/#cisco" class="page__taxonomy-item" rel="tag">cisco</a><span class="sep">, </span>
    
      
      
      <a href="https://xrdocs.github.io/telemetry/tags/#mdt" class="page__taxonomy-item" rel="tag">MDT</a><span class="sep">, </span>
    
      
      
      <a href="https://xrdocs.github.io/telemetry/tags/#openconfig" class="page__taxonomy-item" rel="tag">OpenConfig</a><span class="sep">, </span>
    
      
      
      <a href="https://xrdocs.github.io/telemetry/tags/#telemetry" class="page__taxonomy-item" rel="tag">telemetry</a><span class="sep">, </span>
    
      
      
      <a href="https://xrdocs.github.io/telemetry/tags/#yang" class="page__taxonomy-item" rel="tag">YANG</a><span class="sep">, </span>
    
      
      
      <a href="https://xrdocs.github.io/telemetry/tags/#ydk" class="page__taxonomy-item" rel="tag">YDK</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2016-08-08T23:52:00+00:00">August 08, 2016</time></p>
        
      </footer>

      

<section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=https://xrdocs.github.io/telemetry/tutorials/2016-08-08-configuring-model-driven-telemetry-with-ydk/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https://xrdocs.github.io/telemetry/tutorials/2016-08-08-configuring-model-driven-telemetry-with-ydk/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=https://xrdocs.github.io/telemetry/tutorials/2016-08-08-configuring-model-driven-telemetry-with-ydk/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://xrdocs.github.io/telemetry/tutorials/2016-08-08-configuring-model-driven-telemetry-with-ydk/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>

    <br>
    <br>
    <br>
</section>


    </div>

    
      

<div class="page__comments">
  <h4 class="page__comments-title">Leave a Comment</h4>
  
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/xrdocs"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/xrdocs"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="https://xrdocs.github.io/telemetry/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 Cisco Systems Inc. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="https://xrdocs.github.io/telemetry/assets/js/main.min.js"></script>
<script src="https://xrdocs.github.io/telemetry/assets/js/scrollmenu.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-78256516-1', 'auto');
  ga('send', 'pageview');
</script>






  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'xrdocs';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






<!-- material-scrolltop button -->
<button class="material-scrolltop" type="button"></button>

<!-- material-scrolltop plugin -->
<script src="https://xrdocs.github.io/telemetry/assets/js/material-scrolltop.js"></script>

<!-- Initialize material-scrolltop with (minimal) -->
<script>
    $('body').materialScrollTop();
</script>


  </body>
</html>

